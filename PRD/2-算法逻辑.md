# 🧠 CPT 原型核心算法逻辑优化 (v1.3)

## 1. 逻辑修正说明 (Alignment with IVA-2)

在对比了标准 CPT 测试与 IVA-2 报告后，v1.2 版本中对于“警觉性”和“专注力”的定义需要微调，以更符合临床逻辑：

* **修正点 1 (警觉性 Vigilance):** 原定义关联 RT (反应时)，修正为关联 **漏报数 (Omission Errors)**。警觉性是指在长时间内“监控”目标并对其做出反应的能力，漏报是警觉性丧失的主要标志。
* **修正点 2 (专注力 Focus):** 原定义关联漏报，修正为关联 **反应时变异性 (RT Variability)**。专注力是指保持注意力集中的“质量”，忽快忽慢通常意味着注意力涣散。
* **新增维度 (精细运动多动):** 增加对 **非刺激期无效点击** 的捕捉，直接对应报告中的 Fine Motor Hyperactivity。

## 2. 数据输入定义

算法接收以下原始数据集合：

* `Visual_Data`: 视觉阶段的所有刺激与点击记录。
* `Auditory_Data`: 听觉阶段的所有刺激与点击记录。
* `Extra_Clicks`: 在无刺激呈现期间（ISI）或反应窗口外的额外点击次数。

## 3. 分数计算公式 (Scoring Algorithm)

为了模拟标准商数（均值 100，标准差 15），我们需要设定一个**基准分 (Base)**，并在发现异常表现时进行**扣分**。

> **注意：** 此处的参数 $K$ (扣分系数) 需要在后续测试中校准。当前建议：$K_{omission}=20, K_{commission}=20, K_{var}=10$。

### 3.1 核心维度计算 (单模态计算：视觉/听觉分别计算)

#### A. 注意力维度 (Attention)
1.  **警觉性 (Vigilance):** 衡量“是否漏看”。
    $$Score_{Vig} = 100 - ( \frac{\text{漏报数}}{\text{目标刺激总数}} \times 100 \times K_{omission\_factor} )$$
2.  **反应速度 (Speed):** 衡量“反应快慢”。
    $$Score_{Spd} = 100 + \frac{350ms - MeanRT}{10}$$
    *(注：基准设为 350ms，越快分数越高，越慢分数越低)*
3.  **专注力 (Focus):** 衡量“注意力质量”。
    $$Score_{Foc} = 100 - ( \frac{SD_{RT}}{MeanRT} \times 100 \times K_{var\_factor} )$$
    *(注：使用变异系数 CV 计算，波动越大分数越低)*

#### B. 反应控制维度 (Response Control)
1.  **慎重性 (Prudence):** 衡量“是否冲动”。
    $$Score_{Pru} = 100 - ( \frac{\text{误报数}}{\text{非目标刺激总数}} \times 100 \times K_{commission\_factor} )$$
2.  **一致性 (Consistency):** 衡量“表现稳定性”。
    $$Score_{Con} = 100 - ( \frac{SD_{RT}}{10} \times K_{consistency\_factor} )$$
    *(注：与 Focus 类似，但更侧重于绝对偏差)*

### 3.2 综合商数 (Global Quotients)

将视觉 (Vis) 和听觉 (Aud) 的分数进行加权平均（通常各占 50%）。

1.  **全量注意力商数 (Full Scale Attention Quotient, FAQ):**
    $$FAQ = \frac{(Score_{Vig}^{Vis} + Score_{Vig}^{Aud} + Score_{Spd}^{Vis} + Score_{Spd}^{Aud} + Score_{Foc}^{Vis} + Score_{Foc}^{Aud})}{6}$$
2.  **全量反应控制商数 (Full Scale Response Control Quotient, FRCQ):**
    $$FRCQ = \frac{(Score_{Pru}^{Vis} + Score_{Pru}^{Aud} + Score_{Con}^{Vis} + Score_{Con}^{Aud})}{4}$$

### 3.3 多动指数 (Hyperactivity Index)

$$Index_{Hyper} = \text{Extra\_Clicks} \times 5$$
*(注：每多一次无效点击，多动倾向增加)*

---

## 4. 风险概率 $S$ 计算 (Probability Calculation)

这是用于自然语言输出的核心指标。我们将 $S$ 定义为“表现符合 ADHD 特征的可能性”。

**逻辑：** 当 FAQ 或 FRCQ 低于临界值 (如 85) 时，风险指数呈指数级上升。

1.  **计算注意力风险 ($R_A$):** 若 $FAQ < 85$，则 $R_A = (85 - FAQ) \times 2$；否则 $R_A = 0$。
2.  **计算控制力风险 ($R_C$):** 若 $FRCQ < 85$，则 $R_C = (85 - FRCQ) \times 2$；否则 $R_C = 0$。
3.  **计算多动风险 ($R_H$):** $R_H = \text{Min}(Index_{Hyper} \times 10, 30)$ (上限 30%)。

**最终概率 $S$:**
$$S = \text{Min}(R_A + R_C + R_H, 99)\%$$

> *解释：如果注意力差、控制力差且多动，$S$ 会非常高。如果各项指标均在 100 左右，$S$ 为 0%。*


---

# 📝 需求文档：算法优化与隐私合规 (v2.0)

## 原因

如果不引入年龄和性别的常模校正，这个产品在不同人群中的测试结果将产生严重的偏差，失去参考价值。

## 1. 核心算法优化要求 (Algorithm Optimization)

我们不再使用固定的“基准分”，而是采用 **Z-Score 标准化算法**。这就要求程序内部必须预置一张“模拟常模表”。

### 1.1 新增：模拟常模数据库 (Simulated Norms Database)

请在 JS 代码中内置以下数据结构（基于调研数据构建的模拟值，用于原型演示）：

| 年龄组 | 性别 | 平均反应时 (Mean RT) | 反应时标准差 (SD RT) | 允许误报数 (Commissions) | 允许漏报数 (Omissions) |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **6-12岁 (儿童)** | 男 | 600 ms | 150 ms | 5 次 | 3 次 |
| **6-12岁 (儿童)** | 女 | 650 ms | 140 ms | 3 次 | 4 次 |
| **13-17岁 (青少年)**| 男 | 450 ms | 100 ms | 4 次 | 2 次 |
| **13-17岁 (青少年)**| 女 | 500 ms | 90 ms | 2 次 | 3 次 |
| **18-40岁 (青年)** | 男 | 350 ms | 60 ms | 3 次 | 1 次 |
| **18-40岁 (青年)** | 女 | 400 ms | 55 ms | 1 次 | 2 次 |
| **41-60岁 (中年)** | 男 | 400 ms | 70 ms | 2 次 | 2 次 |
| **41-60岁 (中年)** | 女 | 450 ms | 65 ms | 1 次 | 2 次 |
| **60岁+ (老年)** | - | 550 ms | 120 ms | 3 次 | 4 次 |

### 1.2 优化评分公式

不再直接扣分，而是计算用户数据偏离常模的程度（标准差倍数）。

1.  **获取常模：** 根据用户输入的年龄和性别，从上表中提取对应的 $\mu$ (均值) 和 $\sigma$ (标准差)。
2.  **计算 Z 分数：** $Z = \frac{\text{用户实测值} - \mu}{\sigma}$
3.  **计算最终 T 分数 (标准分):** $T = 50 - (Z \times 10)$
    * *注：对于 RT 和错误数，数值越小越好。如果用户实测值 > 常模均值（Z为正），说明表现差，T分数应低于 50。*
    * **修正逻辑：** 设定 T 分数均值 50，标准差 10。低于 40 分（即偏离常模 1 个标准差以上）视为**风险**。

### 1.3 概率 S 的新定义

$$S = \text{基于 T 分数的加权风险概率}$$
* 如果 $T_{RT} < 40$ 或 $T_{Errors} < 40$，则 $S$ 显著增加。

---

## 2. 首页 (Index) 交互与隐私设置

### 2.1 强制信息录入
为了让算法生效，用户必须在测试开始前提供基本信息。

* **输入项：**
    1.  **年龄 (Age):** 数字输入 (范围 6-90)。
    2.  **性别 (Gender):** 单选 (男/女)。
* **交互逻辑：** “开始测试”按钮默认**置灰不可点**。只有当年龄和性别均已填写/选择后，按钮才变为**高亮可点击**状态。

### 2.2 首页隐私声明 (Privacy Disclaimer)
在首页显眼位置（如“开始测试”按钮下方或页面底部 footer）必须添加以下文案：

> 🔒 **隐私安全声明：**
> 本程序完全基于 **纯前端 (Client-Side)** 运行，所有计算均在您的浏览器本地完成。
> **我们不会收集、上传或存储您的任何个人信息（年龄、性别）或测试数据。**
> 您可以断开网络进行测试以验证安全性。

---

## 3. 报告页 (Report) 隐私与保存提示

### 3.1 顶部数据清除警告
在报告生成后的显著位置，添加黄色背景的提示条：

> ⚠️ **注意：本程序不保存数据！**
> 本程序为纯前端运行，**不会将结果上传至服务器**。
> **刷新页面或关闭浏览器后，所有测试结果将永久消失。**

### 3.2 保存建议
在报告底部添加操作指引：

> 📥 **如何保存报告？**
> * **电脑端：** 请直接使用截图工具，或按 `Ctrl + P` 打印保存为 PDF。
> * **手机端：** 请截屏保存。

---

### 💡 给开发者的执行建议

1.  **数据结构：** 在 `script.js` 顶部建立一个 `const NORMS = { ... }` 对象来存储那张模拟常模表。
2.  **匹配逻辑：** 编写一个 `getNorms(age, gender)` 函数，根据用户输入返回对应的基准值。如果年龄在两个区间之间（如刚好 12 岁），直接归入较低或较高组均可（原型阶段归入儿童组即可）。
3.  **测试验证：** 在开发完成后，试着输入“8岁男孩”和“25岁男子”分别进行测试。即使他们的点击速度一样（比如都是 500ms），8岁男孩应该得到“正常”的评价，而 25 岁男子应该得到“反应迟缓”的评价。这就证明算法优化成功了。